generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

enum UserRole {
    ADMIN
    LECTURER
    STUDENT
}

enum TokenType {
    PASSWORD_RESET
    ACCOUNT_ACTIVATION
}

enum Gender {
    MALE
    FEMALE
}

enum StudentStatus {
    ACTIVE
    SUSPENDED
    WITHDRAWN
    GRADUATED
    DEFERRED
}

enum Semester {
    HARMATTAN
    RAIN
    ACADEMIC_YEAR
}

enum LecturerRole {
    DEAN
    HOD
    LECTURER
    PART_ADVISER
}

enum FileCategory {
    RESULTS
    USER_DATA
    OTHER
}

enum EnrollmentStatus {
    PASSED
    FAILED
    ENROLLED
    ABSENT
}

model User {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    email    String   @unique
    password String?
    role     UserRole

    admin    Admin?
    lecturer Lecturer?
    student  Student?
    tokens   Token?

    @@map("users")
}

model Token {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())

    token     String    @unique
    tokenType TokenType
    expiresAt DateTime

    userId String @unique
    user   User   @relation(fields: [userId], references: [id])

    @@index([expiresAt])
    @@index([token])
    @@map("tokens")
}

model Admin {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    name  String
    phone String?

    userId String @unique
    user   User   @relation(fields: [userId], references: [id])

    @@index([deletedAt])
    @@map("admin")
}

model Lecturer {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    name          String
    phone         String? @unique
    title         String?
    qualification String?

    userId       String                @unique
    user         User                  @relation(fields: [userId], references: [id])
    departmentId String
    department   Department            @relation(fields: [departmentId], references: [id])
    designations LecturerDesignation[]
    courses      CourseLecturer[]
    files        File[]

    @@index([departmentId])
    @@index([deletedAt])
    @@map("lecturers")
}

model LecturerDesignation {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())

    entity String
    role   LecturerRole

    lecturerId String
    lecturer   Lecturer @relation(fields: [lecturerId], references: [id])

    @@unique([entity, role], name: "designation")
    @@index([role])
    @@map("lecturer_designations")
}

model Student {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    matricNumber  String        @unique
    firstName     String
    lastName      String
    otherName     String?
    admissionYear Int           @db.Year
    level         Int           @db.SmallInt
    gender        Gender
    degree        String
    status        StudentStatus @default(ACTIVE)

    userId       String       @unique
    user         User         @relation(fields: [userId], references: [id])
    departmentId String
    department   Department   @relation(fields: [departmentId], references: [id])
    enrollments  Enrollment[]

    @@index([departmentId])
    @@index([level])
    @@index([status])
    @@index([matricNumber])
    @@index([deletedAt])
    @@index([departmentId, level])
    @@index([departmentId, status])
    @@map("students")
}

model Faculty {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    name String @unique @db.VarChar(255)

    departments Department[]

    @@index([deletedAt])
    @@map("faculties")
}

model Department {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    name String @unique

    facultyId String
    faculty   Faculty    @relation(fields: [facultyId], references: [id])
    lecturer  Lecturer[]
    students  Student[]

    @@index([facultyId])
    @@index([deletedAt])
    @@map("departments")
}

model Session {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    academicYear      String   @unique @db.VarChar(50)
    startDate DateTime
    endDate   DateTime

    enrollments Enrollment[]
    courses     Course[]

    @@map("sessions")
}

model Course {
    id        String    @id @default(uuid())
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    code        String    @unique
    title       String
    description String?
    units       Int       @db.SmallInt
    level       Int       @db.SmallInt
    semester    Semester
    isApproved  Boolean   @default(false)
    approvedAt  DateTime?
    isPublished Boolean   @default(false)
    publishedAt DateTime?
    isActive    Boolean   @default(true)

    sessionId   String
    session     Session          @relation(fields: [sessionId], references: [id])
    lecturers   CourseLecturer[]
    enrollments Enrollment[]

    @@index([sessionId])
    @@index([isApproved])
    @@index([isPublished])
    @@index([isActive])
    @@index([deletedAt])
    @@map("courses")
}

model CourseLecturer {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    isCoordinator Boolean @default(false)

    courseId   String
    course     Course   @relation(fields: [courseId], references: [id])
    lecturerId String
    lecturer   Lecturer @relation(fields: [lecturerId], references: [id])

    @@unique([courseId, lecturerId], name: "courseLecturer")
    @@index([courseId])
    @@index([lecturerId])
    @@map("course_lecturers")
}

model Enrollment {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    score  Score?
    status EnrollmentStatus @default(ENROLLED)

    sessionId String
    session   Session @relation(fields: [sessionId], references: [id])
    courseId  String
    course    Course  @relation(fields: [courseId], references: [id])
    studentId String
    student   Student @relation(fields: [studentId], references: [id])

    @@unique([sessionId, courseId, studentId], name: "sessionCourseStudent")
    @@index([studentId, sessionId])
    @@index([sessionId])
    @@index([courseId])
    @@index([studentId])
    @@map("enrollments")
}

model Score {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    score Json

    enrollmentId String     @unique
    enrollment   Enrollment @relation(fields: [enrollmentId], references: [id])

    @@index([enrollmentId])
    @@map("scores")
}

model File {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())

    filename String
    mimetype String
    size     Int
    path     String
    category FileCategory

    lecturerId String
    lecturer   Lecturer @relation(fields: [lecturerId], references: [id])

    @@index([lecturerId])
    @@index([category])
    @@map("files")
}

model AuditLog {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())

    actorInfo String
    action    String
    entity    String
    entityId  String
    details   Json?

    @@index([entity, entityId])
    @@map("audit_logs")
}
